I think you're kind of right. HIMYM is definitely prone to the same gendered stereotyping that all sitcoms are prone to and we've seen Barney a million times before. Like Franzia said, he's Charlie from Two and a Half Men; he's Joey from Friends; he's the best friend of every single male lead in every romantic comedy since the beginning of time. In fact HIMYM has such a conglomerate of stock characters that it's almost surprising it's so successful: there's the hopeless romantic Nice Guy who can't seem to get a break, there's the central romantic couple who are so interconnected that they practically share an identity, and the career-oriented postfeminist who has a hard time in relationships because she's so afraid of commitment. The only trope we're missing, really, is the pathetically lovesick female who falls in love too easily; but I guess Ted sort of covers that ground for both genders, and many of Barney's sexual conquests fit that role as well.

But I also think there's a little something subversive in HIMYM. For one thing, like you said, the two female leads are sort of like the guys on the show - they're both beer-chugging, party-loving ladies who watch football with the guys. And yet they're fashionable, pretty, and very desirable by the men. I don't think they're so much "one of the guys" as they are just regular chicks hanging out with their friends. Most groups of friends are like that in real life and it's a startlingly rare phenomenon in mainstream comedy. It's refreshing; Lily, for one, doesn't hold Marshall back. She not only "allows" him to drink with his friends, she usually participates in it. She's fun without being overbearing; in fact, I think Marshall and Lily's marriage is probably the healthiest and most realistic portrayal of an adult relationship that I've seen on a primetime comedy in, perhaps, ever. There was a brief breakup but it's not the dramatic back-and-forth of Ross and Rachel or Carrie and Aiden; it's just a regular relationship with regular problems and yet it's not as though once they got married, they retreated from social life together. Robin, too, is a subversive character. She might be the typical commitment-phobic career woman but she's probably the most true-to-life character on the show and her reluctance to prioritize her career over marriage and babies is never presented as a negative thing. Sure, her desires posed relationship complications with Ted because they wanted different things, but the show didn't demonize her for that; it was more of a commentary on their incompatibility than on her character. She doesn't want to live Lily's life, and no one seems to think there is anything wrong with that, no one tells her she should get more in touch with her feminine side or that her non-desire to have kids is just a passing phase. Her life choices are presented as a legitimate path for a woman to lead. Furthermore, she's not so rigidly committed to her career that she turns away all romantic prospects for fear that a man might distract her. She dates, she has a social life. She's just a dedicated journalist who's looking for a guy to share her life with who wants similar things.

And I also don't think that the other characters never comment on Barney's debauchery. Lily in particular is often disgusted with his actions. Barney is an extreme parody and I don't even think he's supposed to be lovable so much as just the comic relief on the show. He does awful, date-rapey things that are deplorable and I agree that the show's presentation of his character is evidence of a rape culture. The women he hooks up with are two-dimensional, stupid, easily manipulated, boring stereotypes. (And the episode where Ted flips out on Barney for sleeping with Robin also showed that Ted seems to think breaking the "bro code" is something he's less willing to put up with in a friend than, say, selling a woman into slavery. That's a pretty bad statement for Ted's character.) We're meant to understand that the other characters think Barney's kind of a joke. That doesn't mean the show isn't sexist - it is. But there's something buried underneath, I think, that demonstrates more of a step forward than a step back.